import{Y as T,j as m,a2 as $,X as J,o as j,C as G,ad as M,a as p,c as h,w as i,d as C,a4 as w,Q as q,a9 as _,b as u,Z as R,a3 as P,e as I,aF as X,m as v,aG as Y}from"./index-bc379ee9.js";import{Q as Z}from"./QPage-33f4308b.js";import{_ as H,T as K,C as b}from"./CompactQTable-e57038d0.js";import{a as k}from"./axios-ac4caab3.js";import{a as d}from"./validationHelper-23d76de1.js";import{u as W,g as N}from"./userAuthStore-250486a2.js";import{u as L}from"./use-quasar-34f4ed41.js";import"./QSkeleton-04d8ccba.js";import"./QMarkupTable-2b10f8e2.js";import"./QSelect-b3dbd957.js";import"./QItemLabel-5877a166.js";import"./selection-96bce928.js";import"./rtl-36dd996b.js";import"./QList-9f4065b3.js";const A={class:"w-full flex justify-end pb-3"},F={class:"relative overflow-x-auto shadow-md sm:rounded-lg"},ee=C("div",{class:"text-h6"},"Medium",-1),pe={__name:"UserView",setup(ae){const e=T({sortBy:"createdAt",descending:!0,page:1,rowsPerPage:10,keywords:null,gte:null,lte:null,gtValue:null,ltValue:null,filterColumn:null,rangeColumn:null}),r=m(null),t=L(),g=W(),c=m(!1),y=m(null),O=m(!1),a=$(),S=J(),B=s=>{e.keywords=s.keywords,e.gt=s.gt,e.lt=s.lt,e.gtValue=s.gtValue,e.ltValue=s.ltValue,e.filterColumn=s.filterColumn,e.rangeColumn=s.rangeColumn},U=s=>{e.page=s.page,e.rowsPerPage=s.rowsPerPage,e.descending=s.descending,e.sortBy=s.sortBy||"createdAt"},x=s=>{S.push(`/admin/user/user_list/${s._id}`)},Q=s=>{y.value=s._id,c.value=!0},f=async()=>{var o;const s={method:"GET",url:"api/user/user_lists",headers:{Authorization:`Bearer ${N("token")}`},params:{pageNumber:(e==null?void 0:e.page)||1,pageSize:(e==null?void 0:e.rowsPerPage)||10,descending:e==null?void 0:e.descending,sortBy:(e==null?void 0:e.sortBy)||"createdAt",select:"fullName userName email"}};e!=null&&e.keywords&&(s.params.keywords=e.keywords),e!=null&&e.gt&&(s.params.gt=e.gt),e!=null&&e.lt&&(s.params.lt=e.lt),d(e==null?void 0:e.gtValue)&&(s.params.gtValue=e.gtValue),d(e==null?void 0:e.ltValue)&&(s.params.ltValue=e.ltValue),e!=null&&e.filterColumn&&(s.params.filterColumn=e.filterColumn),e!=null&&e.rangeColumn&&(s.params.rangeColumn=e.rangeColumn),t.loading.show();try{const l=await k.request(s);r.value=l.data,t.loading.hide()}catch(l){console.log(l),t.loading.hide(),((o=l==null?void 0:l.response)==null?void 0:o.status)==401?t.notify({message:l.response.data.message+", Login to try again.",color:"red",position:"top",actions:[{icon:"close",color:"white",handler:()=>{}}]}):t.notify({message:l.message,color:"red",position:"top",actions:[{icon:"close",color:"white",handler:()=>{}}]})}};j(()=>{var s,o,l,n;a.query.hasOwnProperty("pageNumber")&&(e.pageNumber=Number((s=a.query)==null?void 0:s.pageNumber)),a.query.hasOwnProperty("pageSize")&&(e.pageSize=Number((o=a.query)==null?void 0:o.pageSize)),a.query.hasOwnProperty("descending")&&(e.descending=JSON.parse((l=a.query)==null?void 0:l.descending)),a.query.hasOwnProperty("sortBy")&&(e.sortBy=String((n=a.query)==null?void 0:n.sortBy)),a.query.hasOwnProperty("keywords")&&a.query.keywords&&a.query.keywords!=="null"&&(e.keywords=a.query.keywords),a.query.hasOwnProperty("gt")&&a.query.gt&&a.query.gt!=="null"&&(e.gt=String(a.query.gt)),a.query.hasOwnProperty("lt")&&a.query.lt&&a.query.lt!=="null"&&(e.lt=String(a.query.lt)),a.query.hasOwnProperty("gtValue")&&d(a.query.gtValue)&&(e.gtValue=Number(a.query.gtValue)),a.query.hasOwnProperty("ltValue")&&d(a.query.ltValue)&&(e.ltValue=Number(a.query.ltValue)),a.query.hasOwnProperty("filterColumn")&&a.query.filterColumn&&a.query.filterColumn!=="null"&&(e.filterColumn=String(a.query.filterColumn)),a.query.hasOwnProperty("rangeColumn")&&a.query.rangeColumn&&a.query.rangeColumn!=="null"&&(e.rangeColumn=String(a.query.rangeColumn)),f()}),G(e,M(f,1e3));const D=async()=>{var o;const s={method:"delete",url:"api/user/user_lists/"+y.value,headers:{Authorization:`Bearer ${N("token")}`}};try{t.loading.show(),await k.request(s);const l=r==null?void 0:r.value.users.filter(n=>n._id!==y.value);r.value={...JSON.parse(JSON.stringify(r==null?void 0:r.value)),users:l},(r==null?void 0:r.value.users.length)<5&&(r==null?void 0:r.value.pages)!==1&&f(),t.loading.hide(),c.value=!1,t.notify({message:"Deleted successfully!",color:"primary",position:"top",actions:[{icon:"close",color:"white",handler:()=>{}}]})}catch(l){c.value=!1,((o=l==null?void 0:l.response)==null?void 0:o.status)==401?t.notify({message:l.response.data.message+". Login to try again.",color:"red",position:"top",actions:[{icon:"close",color:"white",handler:()=>{}}]}):t.notify({message:l.message,color:"red",position:"top",actions:[{icon:"close",color:"white",handler:()=>{}}]}),t.loading.hide(),console.error(l)}},z=[{name:"fullName",label:"Full name",align:"left",field:"fullName",sortable:!0},{name:"userName",label:"User name",align:"left",field:"userName",sortable:!0},{name:"email",label:"Email",align:"left",field:"email",sortable:!0},{name:"action",label:"Action",field:"action"}];return(s,o)=>(p(),h(Z,{padding:""},{default:i(()=>{var l,n,V;return[C("div",A,[w(g).checkShowOnPermission("createUser")?(p(),h(q,{key:0,style:{background:"green",color:"white"},label:"New User",to:"/admin/user/user_list/create"})):_("",!0)]),C("div",F,[u(H,{columns:z,"data-list":((l=r.value)==null?void 0:l.users)||[],page:((n=r.value)==null?void 0:n.page)||1,pages:((V=r.value)==null?void 0:V.pages)||1,onUpdatePaginate:U,onOnEdit:x,onOnDelete:Q,onOnFilter:B,showEdit:w(g).checkShowOnPermission("editUser"),showDelete:w(g).checkShowOnPermission("deleteUser")},null,8,["data-list","page","pages","showEdit","showDelete"]),O.value?(p(),h(K,{key:0})):_("",!0)]),u(Y,{modelValue:c.value,"onUpdate:modelValue":o[0]||(o[0]=E=>c.value=E)},{default:i(()=>[u(R,{style:{width:"300px","max-width":"80vw"}},{default:i(()=>[u(P,null,{default:i(()=>[ee]),_:1}),u(P,{class:"q-pt-none"},{default:i(()=>[I(" Are you sure you want to delete this user? ")]),_:1}),u(X,{align:"right",class:"bg-white text-teal"},{default:i(()=>[v(u(q,{flat:"",label:"Cancel"},null,512),[[b]]),v(u(q,{flat:"",label:"Delete",onClick:D,color:"red"},null,512),[[b]])]),_:1})]),_:1})]),_:1},8,["modelValue"])]}),_:1}))}};export{pe as default};
