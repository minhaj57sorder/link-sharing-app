import{Y as $,j as m,a2 as L,X as j,o as J,C as G,ad as M,a as w,c as k,w as i,d as C,a4 as q,Q as _,a9 as V,b as n,Z as R,a3 as P,e as I,aF as X,m as v,aG as Y}from"./index-bc379ee9.js";import{Q as Z}from"./QPage-33f4308b.js";import{_ as H,T as K,C as b}from"./CompactQTable-e57038d0.js";import{a as O}from"./axios-ac4caab3.js";import{a as g}from"./validationHelper-23d76de1.js";import{u as W,g as S}from"./userAuthStore-250486a2.js";import{u as A}from"./use-quasar-34f4ed41.js";import"./QSkeleton-04d8ccba.js";import"./QMarkupTable-2b10f8e2.js";import"./QSelect-b3dbd957.js";import"./QItemLabel-5877a166.js";import"./selection-96bce928.js";import"./rtl-36dd996b.js";import"./QList-9f4065b3.js";const F={class:"w-full flex justify-end pb-3"},ee={class:"relative overflow-x-auto shadow-md sm:rounded-lg"},se=C("div",{class:"text-h6"},"Medium",-1),he={__name:"UserLinksView",setup(ae){const e=$({sortBy:"createdAt",descending:!0,page:1,rowsPerPage:10,keywords:null,gte:null,lte:null,gtValue:null,ltValue:null,filterColumn:null,rangeColumn:null}),l=m(null),o=A(),y=W(),c=m(!1),p=m(null),N=m(!1),s=L(),B=j(),x=a=>{e.keywords=a.keywords,e.gt=a.gt,e.lt=a.lt,e.gtValue=a.gtValue,e.ltValue=a.ltValue,e.filterColumn=a.filterColumn,e.rangeColumn=a.rangeColumn},U=a=>{e.page=a.page,e.rowsPerPage=a.rowsPerPage,e.descending=a.descending,e.sortBy=a.sortBy||"createdAt"},Q=a=>{B.push(`/admin/user_links/user_link_list/${a._id}`)},D=a=>{p.value=a._id,c.value=!0},f=async()=>{var r;const a={method:"GET",url:"api/user_links/user_link_lists",headers:{Authorization:`Bearer ${S("token")}`},params:{pageNumber:(e==null?void 0:e.page)||1,pageSize:(e==null?void 0:e.rowsPerPage)||10,descending:e==null?void 0:e.descending,sortBy:(e==null?void 0:e.sortBy)||"createdAt",select:" links"}};e!=null&&e.keywords&&(a.params.keywords=e.keywords),e!=null&&e.gt&&(a.params.gt=e.gt),e!=null&&e.lt&&(a.params.lt=e.lt),g(e==null?void 0:e.gtValue)&&(a.params.gtValue=e.gtValue),g(e==null?void 0:e.ltValue)&&(a.params.ltValue=e.ltValue),e!=null&&e.filterColumn&&(a.params.filterColumn=e.filterColumn),e!=null&&e.rangeColumn&&(a.params.rangeColumn=e.rangeColumn),o.loading.show();try{const t=await O.request(a),u={page:t.data.page,page:t.data.pages,userLinks:t.data.userLinks.map(d=>{const h=d.links.map(E=>E.linkType);return{...d,links:h.join(", ")}})};l.value=u,o.loading.hide()}catch(t){console.log(t),o.loading.hide(),((r=t==null?void 0:t.response)==null?void 0:r.status)==401?o.notify({message:t.response.data.message+", Login to try again.",color:"red",position:"top",actions:[{icon:"close",color:"white",handler:()=>{}}]}):o.notify({message:t.message,color:"red",position:"top",actions:[{icon:"close",color:"white",handler:()=>{}}]})}};J(()=>{var a,r,t,u;s.query.hasOwnProperty("pageNumber")&&(e.pageNumber=Number((a=s.query)==null?void 0:a.pageNumber)),s.query.hasOwnProperty("pageSize")&&(e.pageSize=Number((r=s.query)==null?void 0:r.pageSize)),s.query.hasOwnProperty("descending")&&(e.descending=JSON.parse((t=s.query)==null?void 0:t.descending)),s.query.hasOwnProperty("sortBy")&&(e.sortBy=String((u=s.query)==null?void 0:u.sortBy)),s.query.hasOwnProperty("keywords")&&s.query.keywords&&s.query.keywords!=="null"&&(e.keywords=s.query.keywords),s.query.hasOwnProperty("gt")&&s.query.gt&&s.query.gt!=="null"&&(e.gt=String(s.query.gt)),s.query.hasOwnProperty("lt")&&s.query.lt&&s.query.lt!=="null"&&(e.lt=String(s.query.lt)),s.query.hasOwnProperty("gtValue")&&g(s.query.gtValue)&&(e.gtValue=Number(s.query.gtValue)),s.query.hasOwnProperty("ltValue")&&g(s.query.ltValue)&&(e.ltValue=Number(s.query.ltValue)),s.query.hasOwnProperty("filterColumn")&&s.query.filterColumn&&s.query.filterColumn!=="null"&&(e.filterColumn=String(s.query.filterColumn)),s.query.hasOwnProperty("rangeColumn")&&s.query.rangeColumn&&s.query.rangeColumn!=="null"&&(e.rangeColumn=String(s.query.rangeColumn)),f()}),G(e,M(f,1e3));const z=async()=>{var r;const a={method:"delete",url:"api/user_links/user_link_lists/"+p.value,headers:{Authorization:`Bearer ${S("token")}`}};try{o.loading.show(),await O.request(a);const t=l==null?void 0:l.value.userLinks.filter(u=>u._id!==p.value);l.value={...JSON.parse(JSON.stringify(l==null?void 0:l.value)),userLinks:t},(l==null?void 0:l.value.userLinks.length)<5&&(l==null?void 0:l.value.pages)!==1&&f(),o.loading.hide(),c.value=!1,o.notify({message:"Deleted successfully!",color:"primary",position:"top",actions:[{icon:"close",color:"white",handler:()=>{}}]})}catch(t){c.value=!1,((r=t==null?void 0:t.response)==null?void 0:r.status)==401?o.notify({message:t.response.data.message+". Login to try again.",color:"red",position:"top",actions:[{icon:"close",color:"white",handler:()=>{}}]}):o.notify({message:t.message,color:"red",position:"top",actions:[{icon:"close",color:"white",handler:()=>{}}]}),o.loading.hide(),console.error(t)}},T=[{name:"links",label:"Links",align:"left",field:"links",sortable:!0},{name:"action",label:"Action",field:"action"}];return(a,r)=>(w(),k(Z,{padding:""},{default:i(()=>{var t,u,d;return[C("div",F,[q(y).checkShowOnPermission("createUserLinks")?(w(),k(_,{key:0,style:{background:"green",color:"white"},label:"New User links",to:"/admin/user_links/user_link_list/create"})):V("",!0)]),C("div",ee,[n(H,{columns:T,"data-list":((t=l.value)==null?void 0:t.userLinks)||[],page:((u=l.value)==null?void 0:u.page)||1,pages:((d=l.value)==null?void 0:d.pages)||1,onUpdatePaginate:U,onOnEdit:Q,onOnDelete:D,onOnFilter:x,showEdit:q(y).checkShowOnPermission("editUserLinks"),showDelete:q(y).checkShowOnPermission("deleteUserLinks")},null,8,["data-list","page","pages","showEdit","showDelete"]),N.value?(w(),k(K,{key:0})):V("",!0)]),n(Y,{modelValue:c.value,"onUpdate:modelValue":r[0]||(r[0]=h=>c.value=h)},{default:i(()=>[n(R,{style:{width:"300px","max-width":"80vw"}},{default:i(()=>[n(P,null,{default:i(()=>[se]),_:1}),n(P,{class:"q-pt-none"},{default:i(()=>[I(" Are you sure you want to delete this userLinks? ")]),_:1}),n(X,{align:"right",class:"bg-white text-teal"},{default:i(()=>[v(n(_,{flat:"",label:"Cancel"},null,512),[[b]]),v(n(_,{flat:"",label:"Delete",onClick:z,color:"red"},null,512),[[b]])]),_:1})]),_:1})]),_:1},8,["modelValue"])]}),_:1}))}};export{he as default};
